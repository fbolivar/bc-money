[{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\App.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\components\\AppLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\components\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\components\\TopBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\contexts\\AuthContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":118,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":118,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useEffect, useState } from 'react';\r\nimport type { ReactNode } from 'react';\r\nimport type { User, Session } from '@supabase/supabase-js';\r\nimport { supabase } from '../lib/supabase';\r\nimport type { Profile } from '../lib/supabase';\r\n\r\ninterface AuthContextType {\r\n    user: User | null;\r\n    session: Session | null;\r\n    profile: Profile | null;\r\n    loading: boolean;\r\n    signUp: (email: string, password: string, fullName: string) => Promise<{ error: Error | null }>;\r\n    signIn: (email: string, password: string) => Promise<{ error: Error | null }>;\r\n    signOut: () => Promise<void>;\r\n    refreshProfile: () => Promise<void>;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n    const [user, setUser] = useState<User | null>(null);\r\n    const [session, setSession] = useState<Session | null>(null);\r\n    const [profile, setProfile] = useState<Profile | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const fetchProfile = async (userId: string) => {\r\n        const { data, error } = await supabase\r\n            .from('profiles')\r\n            .select('*')\r\n            .eq('id', userId)\r\n            .single();\r\n\r\n        if (!error && data) {\r\n            setProfile(data as Profile);\r\n        }\r\n    };\r\n\r\n    const refreshProfile = async () => {\r\n        if (user) {\r\n            await fetchProfile(user.id);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        // Get initial session\r\n        supabase.auth.getSession().then(({ data: { session } }) => {\r\n            setSession(session);\r\n            setUser(session?.user ?? null);\r\n            if (session?.user) {\r\n                fetchProfile(session.user.id);\r\n            }\r\n            setLoading(false);\r\n        });\r\n\r\n        // Listen for auth changes\r\n        const { data: { subscription } } = supabase.auth.onAuthStateChange(\r\n            async (_event, session) => {\r\n                setSession(session);\r\n                setUser(session?.user ?? null);\r\n                if (session?.user) {\r\n                    await fetchProfile(session.user.id);\r\n                } else {\r\n                    setProfile(null);\r\n                }\r\n                setLoading(false);\r\n            }\r\n        );\r\n\r\n        return () => subscription.unsubscribe();\r\n    }, []);\r\n\r\n    const signUp = async (email: string, password: string, fullName: string) => {\r\n        const { error } = await supabase.auth.signUp({\r\n            email,\r\n            password,\r\n            options: {\r\n                data: {\r\n                    full_name: fullName,\r\n                },\r\n            },\r\n        });\r\n        return { error };\r\n    };\r\n\r\n    const signIn = async (email: string, password: string) => {\r\n        const { error } = await supabase.auth.signInWithPassword({\r\n            email,\r\n            password,\r\n        });\r\n        return { error };\r\n    };\r\n\r\n    const signOut = async () => {\r\n        await supabase.auth.signOut();\r\n        setUser(null);\r\n        setSession(null);\r\n        setProfile(null);\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider\r\n            value={{\r\n                user,\r\n                session,\r\n                profile,\r\n                loading,\r\n                signUp,\r\n                signIn,\r\n                signOut,\r\n                refreshProfile,\r\n            }}\r\n        >\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useAuth() {\r\n    const context = useContext(AuthContext);\r\n    if (context === undefined) {\r\n        throw new Error('useAuth must be used within an AuthProvider');\r\n    }\r\n    return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\contexts\\ThemeContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":35,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":35,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useState, useEffect, ReactNode } from 'react';\r\n\r\ntype Theme = 'light' | 'dark';\r\n\r\ninterface ThemeContextType {\r\n    theme: Theme;\r\n    toggleTheme: () => void;\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\r\n\r\nexport function ThemeProvider({ children }: { children: ReactNode }) {\r\n    const [theme, setTheme] = useState<Theme>(() => {\r\n        const stored = localStorage.getItem('bc-money-theme');\r\n        if (stored === 'light' || stored === 'dark') return stored;\r\n        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\r\n    });\r\n\r\n    useEffect(() => {\r\n        document.documentElement.setAttribute('data-theme', theme);\r\n        localStorage.setItem('bc-money-theme', theme);\r\n    }, [theme]);\r\n\r\n    const toggleTheme = () => {\r\n        setTheme(prev => prev === 'light' ? 'dark' : 'light');\r\n    };\r\n\r\n    return (\r\n        <ThemeContext.Provider value={{ theme, toggleTheme }}>\r\n            {children}\r\n        </ThemeContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useTheme() {\r\n    const context = useContext(ThemeContext);\r\n    if (context === undefined) {\r\n        throw new Error('useTheme must be used within a ThemeProvider');\r\n    }\r\n    return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\lib\\supabase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Asesor.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Asesor.tsx:119:13\n  117 |     useEffect(() => {\n  118 |         if (user) {\n> 119 |             loadContext();\n      |             ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  120 |             loadHistory();\n  121 |         }\n  122 |     }, [user, loadContext, loadHistory]);","line":119,"column":13,"nodeType":null,"endLine":119,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { Send, Sparkles, User, AlertTriangle } from 'lucide-react';\r\nimport { supabase } from '../lib/supabase';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { format, subDays } from 'date-fns';\r\nimport './Asesor.css';\r\n\r\ninterface Message {\r\n    id: string;\r\n    role: 'user' | 'assistant';\r\n    content: string;\r\n    structured?: {\r\n        summary: string[];\r\n        alerts: string[];\r\n        shortTermPlan: string;\r\n        mediumTermPlan: string;\r\n        longTermPlan: string;\r\n        nextAction: string;\r\n    };\r\n    timestamp: Date;\r\n}\r\n\r\ninterface ContextData {\r\n    profile: {\r\n        income_type?: string;\r\n        life_situation?: string;\r\n        risk_tolerance?: string;\r\n        investment_horizon?: string;\r\n    };\r\n    last30Days: {\r\n        income: number;\r\n        expenses: number;\r\n        savings: number;\r\n        savingsRate: number;\r\n        transactionCount: number;\r\n    };\r\n    goals: Array<{\r\n        name: string;\r\n        target: number;\r\n        current: number;\r\n        progress: string;\r\n    }>;\r\n    budgets: number;\r\n}\r\n\r\nexport function Asesor() {\r\n    const { user, profile } = useAuth();\r\n    const [messages, setMessages] = useState<Message[]>([]);\r\n    const [input, setInput] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const [context, setContext] = useState<ContextData | null>(null);\r\n    const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n    const currency = profile?.currency || 'USD';\r\n\r\n    // Move functions up and wrap in useCallback\r\n    const loadContext = useCallback(async () => {\r\n        if (!user) return;\r\n\r\n        const now = new Date();\r\n        const thirtyDaysAgo = subDays(now, 30);\r\n\r\n        const [tx30, goals, budgets] = await Promise.all([\r\n            supabase.from('transactions').select('*').eq('user_id', user.id).gte('date', format(thirtyDaysAgo, 'yyyy-MM-dd')),\r\n            supabase.from('goals').select('*').eq('user_id', user.id).eq('status', 'active'),\r\n            supabase.from('budgets').select('*').eq('user_id', user.id),\r\n        ]);\r\n\r\n        const tx30Data = tx30.data || [];\r\n        const income30 = tx30Data.filter(t => t.type === 'income').reduce((s, t) => s + Number(t.amount), 0);\r\n        const expenses30 = tx30Data.filter(t => t.type === 'expense').reduce((s, t) => s + Number(t.amount), 0);\r\n\r\n        setContext({\r\n            profile: {\r\n                income_type: profile?.income_type,\r\n                life_situation: profile?.life_situation,\r\n                risk_tolerance: profile?.risk_tolerance,\r\n                investment_horizon: profile?.investment_horizon,\r\n            },\r\n            last30Days: {\r\n                income: income30,\r\n                expenses: expenses30,\r\n                savings: income30 - expenses30,\r\n                savingsRate: income30 > 0 ? ((income30 - expenses30) / income30 * 100) : 0,\r\n                transactionCount: tx30Data.length,\r\n            },\r\n            goals: goals.data?.map(g => ({\r\n                name: g.name,\r\n                target: g.target_amount,\r\n                current: g.current_amount,\r\n                progress: ((Number(g.current_amount) / Number(g.target_amount)) * 100).toFixed(0),\r\n            })) || [],\r\n            budgets: budgets.data?.length || 0,\r\n        });\r\n    }, [user, profile]);\r\n\r\n    const loadHistory = useCallback(async () => {\r\n        if (!user) return;\r\n        const { data } = await supabase\r\n            .from('ai_conversations')\r\n            .select('*')\r\n            .eq('user_id', user.id)\r\n            .order('created_at', { ascending: true })\r\n            .limit(20);\r\n\r\n        if (data) {\r\n            setMessages(data.map(m => ({\r\n                id: m.id,\r\n                role: m.role as 'user' | 'assistant',\r\n                content: m.content,\r\n                structured: m.structured_response as Message['structured'],\r\n                timestamp: new Date(m.created_at),\r\n            })));\r\n        }\r\n    }, [user]);\r\n\r\n    useEffect(() => {\r\n        if (user) {\r\n            loadContext();\r\n            loadHistory();\r\n        }\r\n    }, [user, loadContext, loadHistory]);\r\n\r\n    useEffect(() => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n    }, [messages]);\r\n\r\n    const generateAIResponse = async (): Promise<{ content: string; structured?: Message['structured'] }> => {\r\n        // This is a mock AI response. In production, this would call your Supabase Edge Function\r\n        // which would then call OpenAI/Gemini API with the user's context.\r\n\r\n        const ctx = context;\r\n\r\n        // Simple rule-based responses for demo (replace with real AI call)\r\n        const responses = {\r\n            summary: [\r\n                `Tus ingresos de los √∫ltimos 30 d√≠as: ${currency} ${ctx?.last30Days?.income?.toLocaleString() || 0}`,\r\n                `Tus gastos de los √∫ltimos 30 d√≠as: ${currency} ${ctx?.last30Days?.expenses?.toLocaleString() || 0}`,\r\n                `Tasa de ahorro actual: ${ctx?.last30Days?.savingsRate.toFixed(1) || 0}%`,\r\n            ],\r\n            alerts: (ctx?.last30Days?.savingsRate ?? 0) < 10\r\n                ? ['‚ö†Ô∏è Tu tasa de ahorro est√° por debajo del 10%. Considera revisar gastos no esenciales.']\r\n                : ['‚úÖ Tu tasa de ahorro est√° en buen nivel. ¬°Sigue as√≠!'],\r\n            shortTermPlan: 'Mant√©n tu fondo de emergencia como prioridad. Revisa suscripciones que no uses.',\r\n            mediumTermPlan: 'Una vez completo tu fondo de emergencia, considera diversificar en ETFs de bajo costo.',\r\n            longTermPlan: 'Para retiro a largo plazo, considera maximizar cuentas con beneficios fiscales.',\r\n            nextAction: ctx?.goals?.length === 0\r\n                ? 'Crea tu primera meta de ahorro hoy.'\r\n                : `Aporta a tu meta \"${ctx?.goals && ctx.goals[0]?.name}\" esta semana.`,\r\n        };\r\n\r\n        const content = `\r\n**üìä Resumen de tu Situaci√≥n:**\r\n${responses.summary.map(s => `‚Ä¢ ${s}`).join('\\n')}\r\n\r\n**‚ö° Alertas:**\r\n${responses.alerts.map(a => `‚Ä¢ ${a}`).join('\\n')}\r\n\r\n**üìã Plan Recomendado:**\r\n- **Corto Plazo (0-3 meses):** ${responses.shortTermPlan}\r\n- **Mediano Plazo (3-24 meses):** ${responses.mediumTermPlan}\r\n- **Largo Plazo (2-10 a√±os):** ${responses.longTermPlan}\r\n\r\n**‚úÖ Tu Pr√≥xima Acci√≥n:**\r\n${responses.nextAction}\r\n\r\n---\r\n*Recuerda: esto es orientaci√≥n educativa, no asesor√≠a financiera profesional.*\r\n    `.trim();\r\n\r\n        return { content, structured: responses };\r\n    };\r\n\r\n    const handleSend = async () => {\r\n        if (!input.trim() || loading) return;\r\n\r\n        const userMessage = input.trim();\r\n        setInput('');\r\n\r\n        const userMsg: Message = {\r\n            id: Date.now().toString(),\r\n            role: 'user',\r\n            content: userMessage,\r\n            timestamp: new Date(),\r\n        };\r\n\r\n        setMessages(prev => [...prev, userMsg]);\r\n        setLoading(true);\r\n\r\n        // Save user message\r\n        await supabase.from('ai_conversations').insert({\r\n            user_id: user!.id,\r\n            role: 'user',\r\n            content: userMessage,\r\n        });\r\n\r\n        try {\r\n            const response = await generateAIResponse();\r\n\r\n            const assistantMsg: Message = {\r\n                id: (Date.now() + 1).toString(),\r\n                role: 'assistant',\r\n                content: response.content,\r\n                structured: response.structured,\r\n                timestamp: new Date(),\r\n            };\r\n\r\n            setMessages(prev => [...prev, assistantMsg]);\r\n\r\n            // Save assistant message\r\n            await supabase.from('ai_conversations').insert({\r\n                user_id: user!.id,\r\n                role: 'assistant',\r\n                content: response.content,\r\n                structured_response: response.structured,\r\n                context_snapshot: context,\r\n            });\r\n        } catch (error) {\r\n            console.error('AI Error:', error);\r\n        }\r\n\r\n        setLoading(false);\r\n    };\r\n\r\n    const handleQuickAction = (action: string) => {\r\n        setInput(action);\r\n    };\r\n\r\n    return (\r\n        <div className=\"asesor-page animate-fadeIn\">\r\n            <div className=\"asesor-container\">\r\n                {/* Sidebar with context */}\r\n                <aside className=\"asesor-sidebar\">\r\n                    <div className=\"sidebar-section\">\r\n                        <h3>üß† Tu Contexto</h3>\r\n                        {context && (\r\n                            <div className=\"context-cards\">\r\n                                <div className=\"context-card\">\r\n                                    <span className=\"label\">Ingresos (30d)</span>\r\n                                    <span className=\"value\">{currency} {context.last30Days?.income?.toLocaleString()}</span>\r\n                                </div>\r\n                                <div className=\"context-card\">\r\n                                    <span className=\"label\">Gastos (30d)</span>\r\n                                    <span className=\"value\">{currency} {context.last30Days?.expenses?.toLocaleString()}</span>\r\n                                </div>\r\n                                <div className=\"context-card\">\r\n                                    <span className=\"label\">Tasa de Ahorro</span>\r\n                                    <span className=\"value\">{context.last30Days?.savingsRate}%</span>\r\n                                </div>\r\n                                <div className=\"context-card\">\r\n                                    <span className=\"label\">Metas Activas</span>\r\n                                    <span className=\"value\">{context.goals?.length || 0}</span>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    <div className=\"sidebar-section\">\r\n                        <h3>üí° Preguntas R√°pidas</h3>\r\n                        <div className=\"quick-actions\">\r\n                            <button onClick={() => handleQuickAction('¬øC√≥mo est√° mi situaci√≥n financiera?')}>\r\n                                Analiza mi situaci√≥n\r\n                            </button>\r\n                            <button onClick={() => handleQuickAction('¬øD√≥nde puedo recortar gastos?')}>\r\n                                ¬øD√≥nde recortar gastos?\r\n                            </button>\r\n                            <button onClick={() => handleQuickAction('Dame un plan de ahorro')}>\r\n                                Plan de ahorro\r\n                            </button>\r\n                            <button onClick={() => handleQuickAction('¬øC√≥mo empezar a invertir?')}>\r\n                                Comenzar a invertir\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"sidebar-section disclaimer\">\r\n                        <AlertTriangle size={16} />\r\n                        <p>Esto es orientaci√≥n educativa, no asesor√≠a financiera profesional.</p>\r\n                    </div>\r\n                </aside>\r\n\r\n                {/* Chat area */}\r\n                <main className=\"chat-area\">\r\n                    <div className=\"chat-messages\">\r\n                        {messages.length === 0 && (\r\n                            <div className=\"welcome-message\">\r\n                                <Sparkles size={48} className=\"welcome-icon\" />\r\n                                <h2>¬°Hola! Soy tu Coach Financiero</h2>\r\n                                <p>Estoy aqu√≠ para ayudarte a tomar mejores decisiones con tu dinero.\r\n                                    Preg√∫ntame sobre tu situaci√≥n, c√≥mo ahorrar m√°s, o c√≥mo empezar a invertir.</p>\r\n                            </div>\r\n                        )}\r\n\r\n                        {messages.map((msg) => (\r\n                            <div key={msg.id} className={`message ${msg.role}`}>\r\n                                <div className=\"message-avatar\">\r\n                                    {msg.role === 'user' ? <User size={20} /> : <Sparkles size={20} />}\r\n                                </div>\r\n                                <div className=\"message-content\">\r\n                                    <div className=\"message-text\" dangerouslySetInnerHTML={{\r\n                                        __html: msg.content.replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>').replace(/\\n/g, '<br/>')\r\n                                    }} />\r\n                                    <span className=\"message-time\">\r\n                                        {format(msg.timestamp, 'HH:mm')}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n\r\n                        {loading && (\r\n                            <div className=\"message assistant\">\r\n                                <div className=\"message-avatar\"><Sparkles size={20} /></div>\r\n                                <div className=\"message-content\">\r\n                                    <div className=\"typing-indicator\">\r\n                                        <span></span><span></span><span></span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div ref={messagesEndRef} />\r\n                    </div>\r\n\r\n                    <div className=\"chat-input-area\">\r\n                        <input\r\n                            type=\"text\"\r\n                            className=\"chat-input\"\r\n                            placeholder=\"Preg√∫ntame sobre tus finanzas...\"\r\n                            value={input}\r\n                            onChange={(e) => setInput(e.target.value)}\r\n                            onKeyDown={(e) => e.key === 'Enter' && handleSend()}\r\n                            disabled={loading}\r\n                        />\r\n                        <button\r\n                            className=\"btn btn-primary send-btn\"\r\n                            onClick={handleSend}\r\n                            disabled={loading || !input.trim()}\r\n                        >\r\n                            <Send size={18} />\r\n                        </button>\r\n                    </div>\r\n                </main>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Categorias.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Dashboard.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Dashboard.tsx:88:13\n  86 |     useEffect(() => {\n  87 |         if (user) {\n> 88 |             fetchData();\n     |             ^^^^^^^^^ Avoid calling setState() directly within an effect\n  89 |         }\n  90 |     }, [user, fetchData]);\n  91 |","line":88,"column":13,"nodeType":null,"endLine":88,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":349,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14970,14973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14970,14973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport {\r\n    TrendingUp,\r\n    TrendingDown,\r\n    Wallet,\r\n    Target,\r\n    AlertCircle,\r\n    ArrowUpRight,\r\n    ArrowDownRight,\r\n    Plus,\r\n} from 'lucide-react';\r\nimport {\r\n    PieChart,\r\n    Pie,\r\n    Cell,\r\n    AreaChart,\r\n    Area,\r\n    BarChart,\r\n    Bar,\r\n    XAxis,\r\n    YAxis,\r\n    CartesianGrid,\r\n    Tooltip,\r\n    ResponsiveContainer,\r\n} from 'recharts';\r\nimport { supabase } from '../lib/supabase';\r\nimport type { Transaction, Goal, Budget, Category } from '../lib/supabase';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { format, startOfMonth, endOfMonth, subMonths } from 'date-fns';\r\nimport { es } from 'date-fns/locale';\r\nimport { Link } from 'react-router-dom';\r\nimport './Dashboard.css';\r\n\r\nexport function Dashboard() {\r\n    const { user, profile } = useAuth();\r\n    const [loading, setLoading] = useState(true);\r\n    const [transactions, setTransactions] = useState<Transaction[]>([]);\r\n    const [goals, setGoals] = useState<Goal[]>([]);\r\n    const [categories, setCategories] = useState<Category[]>([]);\r\n    const [budgets, setBudgets] = useState<Budget[]>([]);\r\n\r\n    const currency = profile?.currency || 'USD';\r\n\r\n    const fetchData = useCallback(async () => {\r\n        if (!user) return;\r\n        const now = new Date();\r\n        const monthStart = startOfMonth(now);\r\n        const monthEnd = endOfMonth(now);\r\n\r\n        // Fetch transactions for current month\r\n        const { data: txData } = await supabase\r\n            .from('transactions')\r\n            .select('*')\r\n            .eq('user_id', user.id)\r\n            .gte('date', format(monthStart, 'yyyy-MM-dd'))\r\n            .lte('date', format(monthEnd, 'yyyy-MM-dd'))\r\n            .order('date', { ascending: false });\r\n\r\n        // Fetch goals\r\n        const { data: goalsData } = await supabase\r\n            .from('goals')\r\n            .select('*')\r\n            .eq('user_id', user.id)\r\n            .eq('status', 'active')\r\n            .order('priority', { ascending: true });\r\n\r\n        // Fetch categories\r\n        const { data: catData } = await supabase\r\n            .from('categories')\r\n            .select('*')\r\n            .or(`user_id.eq.${user.id},is_system.eq.true`);\r\n\r\n        // Fetch budgets\r\n        const { data: budgetData } = await supabase\r\n            .from('budgets')\r\n            .select('*')\r\n            .eq('user_id', user.id);\r\n\r\n        setTransactions(txData || []);\r\n        setGoals(goalsData || []);\r\n        setCategories(catData || []);\r\n        setBudgets(budgetData || []);\r\n        setLoading(false);\r\n    }, [user]);\r\n\r\n    useEffect(() => {\r\n        if (user) {\r\n            fetchData();\r\n        }\r\n    }, [user, fetchData]);\r\n\r\n    // Calculate metrics\r\n    const income = useMemo(() => transactions\r\n        .filter((t) => t.type === 'income')\r\n        .reduce((sum, t) => sum + Number(t.amount), 0), [transactions]);\r\n\r\n    const expenses = useMemo(() => transactions\r\n        .filter((t) => t.type === 'expense')\r\n        .reduce((sum, t) => sum + Number(t.amount), 0), [transactions]);\r\n\r\n    const balance = income - expenses;\r\n    const savingsRate = income > 0 ? ((income - expenses) / income) * 100 : 0;\r\n\r\n    // Category breakdown for pie chart\r\n    const categoryBreakdown = useMemo(() => transactions\r\n        .filter((t) => t.type === 'expense')\r\n        .reduce((acc: Record<string, number>, t) => {\r\n            const catId = t.category_id || 'other';\r\n            acc[catId] = (acc[catId] || 0) + Number(t.amount);\r\n            return acc;\r\n        }, {}), [transactions]);\r\n\r\n    const pieData = useMemo(() => Object.entries(categoryBreakdown)\r\n        .map(([catId, amount]) => {\r\n            const category = categories.find((c) => c.id === catId);\r\n            return {\r\n                name: category?.name || 'Otros',\r\n                value: amount,\r\n                color: category?.color || '#6B7280',\r\n            };\r\n        })\r\n        .sort((a, b) => b.value - a.value)\r\n        .slice(0, 6), [categoryBreakdown, categories]);\r\n\r\n    // Weekly trend data (last 4 weeks)\r\n    const weeklyData = useMemo(() => Array.from({ length: 4 }, (_, i) => {\r\n        const weekStart = subMonths(new Date(), 0);\r\n        weekStart.setDate(weekStart.getDate() - (3 - i) * 7);\r\n        const weekExpenses = transactions\r\n            .filter((t) => {\r\n                const txDate = new Date(t.date);\r\n                return (\r\n                    t.type === 'expense' &&\r\n                    txDate >= weekStart &&\r\n                    txDate < new Date(weekStart.getTime() + 7 * 24 * 60 * 60 * 1000)\r\n                );\r\n            })\r\n            .reduce((sum, t) => sum + Number(t.amount), 0);\r\n        return {\r\n            name: `Sem ${i + 1}`,\r\n            gastos: weekExpenses,\r\n        };\r\n    }), [transactions]);\r\n\r\n    // Monthly comparison (last 6 months)\r\n    const monthlyData = useMemo(() => Array.from({ length: 6 }, (_, i) => {\r\n        const month = subMonths(new Date(), 5 - i);\r\n        // Deterministic pseudo-random based on index for consistent render\r\n        const pseudoRandom = (seed: number) => {\r\n            const x = Math.sin(seed) * 10000;\r\n            return x - Math.floor(x);\r\n        };\r\n        const seed = month.getTime();\r\n\r\n        return {\r\n            name: format(month, 'MMM', { locale: es }),\r\n            ingresos: pseudoRandom(seed) * 3000 + 1500, // Placeholder\r\n            gastos: pseudoRandom(seed + 1) * 2000 + 1000,\r\n        };\r\n    }), []); // Empty deps so it's calculated once (or when component remounts)\r\n\r\n    // Budget usage\r\n    const budgetUsage = useMemo(() => budgets.map((budget) => {\r\n        const spent = transactions\r\n            .filter((t) => t.type === 'expense' && t.category_id === budget.category_id)\r\n            .reduce((sum, t) => sum + Number(t.amount), 0);\r\n        const percentage = (spent / Number(budget.amount)) * 100;\r\n        const category = categories.find((c) => c.id === budget.category_id);\r\n        return {\r\n            category: category?.name || 'General',\r\n            budget: Number(budget.amount),\r\n            spent,\r\n            percentage,\r\n            status: percentage <= 80 ? 'success' : percentage <= 100 ? 'warning' : 'danger',\r\n        };\r\n    }), [budgets, transactions, categories]);\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"loading-container\">\r\n                <div className=\"loading-spinner\"></div>\r\n                <p>Cargando tu dashboard...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"dashboard animate-fadeIn\">\r\n            {/* Quick Actions */}\r\n            <div className=\"quick-actions\">\r\n                <Link to=\"/transacciones?new=income\" className=\"quick-action-btn income\">\r\n                    <Plus size={18} />\r\n                    <span>Registrar Ingreso</span>\r\n                </Link>\r\n                <Link to=\"/transacciones?new=expense\" className=\"quick-action-btn expense\">\r\n                    <Plus size={18} />\r\n                    <span>Registrar Gasto</span>\r\n                </Link>\r\n            </div>\r\n\r\n            {/* Metric Cards */}\r\n            <div className=\"metrics-grid\">\r\n                <div className=\"metric-card\">\r\n                    <div className=\"metric-header\">\r\n                        <span className=\"metric-label\">Balance del Mes</span>\r\n                        <div className={`metric-badge ${balance >= 0 ? 'positive' : 'negative'}`}>\r\n                            {balance >= 0 ? <TrendingUp size={14} /> : <TrendingDown size={14} />}\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"metric-value\">\r\n                        <span className={balance >= 0 ? 'text-success' : 'text-danger'}>\r\n                            {balance >= 0 ? '+' : ''}{currency} {balance.toLocaleString('en-US', { minimumFractionDigits: 2 })}\r\n                        </span>\r\n                    </div>\r\n                    <div className=\"metric-detail\">\r\n                        <span className=\"income\">\r\n                            <ArrowUpRight size={14} /> {currency} {income.toLocaleString()}\r\n                        </span>\r\n                        <span className=\"expense\">\r\n                            <ArrowDownRight size={14} /> {currency} {expenses.toLocaleString()}\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"metric-card\">\r\n                    <div className=\"metric-header\">\r\n                        <span className=\"metric-label\">Tasa de Ahorro</span>\r\n                        <Wallet size={18} className=\"metric-icon\" />\r\n                    </div>\r\n                    <div className=\"metric-value\">\r\n                        <span className={savingsRate >= 20 ? 'text-success' : savingsRate >= 10 ? 'text-warning' : 'text-danger'}>\r\n                            {savingsRate.toFixed(1)}%\r\n                        </span>\r\n                    </div>\r\n                    <div className=\"metric-subtitle\">\r\n                        {savingsRate >= 20\r\n                            ? '¬°Excelente! Est√°s ahorrando bien'\r\n                            : savingsRate >= 10\r\n                                ? 'Buen inicio, intenta llegar al 20%'\r\n                                : 'Revisa tus gastos para mejorar'}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"metric-card\">\r\n                    <div className=\"metric-header\">\r\n                        <span className=\"metric-label\">Presupuesto Usado</span>\r\n                        <Target size={18} className=\"metric-icon\" />\r\n                    </div>\r\n                    <div className=\"metric-value\">\r\n                        {budgetUsage.length > 0 ? (\r\n                            <span>\r\n                                {Math.round(\r\n                                    budgetUsage.reduce((sum, b) => sum + b.percentage, 0) / budgetUsage.length\r\n                                )}%\r\n                            </span>\r\n                        ) : (\r\n                            <span className=\"text-secondary\">Sin presupuestos</span>\r\n                        )}\r\n                    </div>\r\n                    <div className=\"budget-bars\">\r\n                        {budgetUsage.slice(0, 3).map((b) => (\r\n                            <div key={b.category} className=\"mini-budget\">\r\n                                <span>{b.category}</span>\r\n                                <div className=\"progress\">\r\n                                    <div\r\n                                        className={`progress-bar progress-${b.status}`}\r\n                                        style={{ width: `${Math.min(b.percentage, 100)}%` }}\r\n                                    ></div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"metric-card goals-card\">\r\n                    <div className=\"metric-header\">\r\n                        <span className=\"metric-label\">Metas Activas</span>\r\n                        <Target size={18} className=\"metric-icon\" />\r\n                    </div>\r\n                    {goals.length > 0 ? (\r\n                        <div className=\"goals-preview\">\r\n                            {goals.slice(0, 2).map((goal) => {\r\n                                const progress = (Number(goal.current_amount) / Number(goal.target_amount)) * 100;\r\n                                return (\r\n                                    <div key={goal.id} className=\"goal-item\">\r\n                                        <div className=\"goal-info\">\r\n                                            <span className=\"goal-name\">{goal.name}</span>\r\n                                            <span className=\"goal-amount\">\r\n                                                {currency} {Number(goal.current_amount).toLocaleString()} / {Number(goal.target_amount).toLocaleString()}\r\n                                            </span>\r\n                                        </div>\r\n                                        <div className=\"progress\">\r\n                                            <div\r\n                                                className=\"progress-bar progress-success\"\r\n                                                style={{ width: `${progress}%` }}\r\n                                            ></div>\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    ) : (\r\n                        <p className=\"no-data\">\r\n                            <Link to=\"/metas\">Crea tu primera meta</Link>\r\n                        </p>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Alerts */}\r\n            {budgetUsage.some((b) => b.status === 'danger') && (\r\n                <div className=\"alerts-section\">\r\n                    <div className=\"alert alert-warning\">\r\n                        <AlertCircle size={20} />\r\n                        <div>\r\n                            <strong>Atenci√≥n:</strong> Has excedido el presupuesto en{' '}\r\n                            {budgetUsage\r\n                                .filter((b) => b.status === 'danger')\r\n                                .map((b) => b.category)\r\n                                .join(', ')}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Charts Row */}\r\n            <div className=\"charts-grid\">\r\n                {/* Category Breakdown */}\r\n                <div className=\"chart-card\">\r\n                    <h3 className=\"chart-title\">Gastos por Categor√≠a</h3>\r\n                    {pieData.length > 0 ? (\r\n                        <div className=\"pie-chart-container\">\r\n                            <ResponsiveContainer width=\"100%\" height={200}>\r\n                                <PieChart>\r\n                                    <Pie\r\n                                        data={pieData}\r\n                                        cx=\"50%\"\r\n                                        cy=\"50%\"\r\n                                        innerRadius={50}\r\n                                        outerRadius={80}\r\n                                        paddingAngle={2}\r\n                                        dataKey=\"value\"\r\n                                    >\r\n                                        {pieData.map((entry, index) => (\r\n                                            <Cell key={`cell-${index}`} fill={entry.color} />\r\n                                        ))}\r\n                                    </Pie>\r\n                                    <Tooltip\r\n                                        formatter={(value: any) => [`${currency} ${Number(value).toLocaleString()}`, 'Monto']}\r\n                                    />\r\n                                </PieChart>\r\n                            </ResponsiveContainer>\r\n                            <div className=\"pie-legend\">\r\n                                {pieData.map((entry, index) => (\r\n                                    <div key={index} className=\"legend-item\">\r\n                                        <span className=\"legend-color\" style={{ backgroundColor: entry.color }}></span>\r\n                                        <span className=\"legend-label\">{entry.name}</span>\r\n                                        <span className=\"legend-value\">{currency} {entry.value.toLocaleString()}</span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <p className=\"no-data\">No hay gastos este mes</p>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Weekly Trend */}\r\n                <div className=\"chart-card\">\r\n                    <h3 className=\"chart-title\">Tendencia Semanal</h3>\r\n                    <ResponsiveContainer width=\"100%\" height={200}>\r\n                        <AreaChart data={weeklyData}>\r\n                            <defs>\r\n                                <linearGradient id=\"colorGastos\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                    <stop offset=\"5%\" stopColor=\"#EF4444\" stopOpacity={0.3} />\r\n                                    <stop offset=\"95%\" stopColor=\"#EF4444\" stopOpacity={0} />\r\n                                </linearGradient>\r\n                            </defs>\r\n                            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"var(--color-border)\" />\r\n                            <XAxis dataKey=\"name\" stroke=\"var(--color-text-tertiary)\" fontSize={12} />\r\n                            <YAxis stroke=\"var(--color-text-tertiary)\" fontSize={12} />\r\n                            <Tooltip\r\n                                contentStyle={{\r\n                                    backgroundColor: 'var(--color-surface)',\r\n                                    border: '1px solid var(--color-border)',\r\n                                    borderRadius: '8px',\r\n                                }}\r\n                            />\r\n                            <Area\r\n                                type=\"monotone\"\r\n                                dataKey=\"gastos\"\r\n                                stroke=\"#EF4444\"\r\n                                fill=\"url(#colorGastos)\"\r\n                                strokeWidth={2}\r\n                            />\r\n                        </AreaChart>\r\n                    </ResponsiveContainer>\r\n                </div>\r\n\r\n                {/* Monthly Comparison */}\r\n                <div className=\"chart-card wide\">\r\n                    <h3 className=\"chart-title\">Ingresos vs Gastos (√öltimos 6 meses)</h3>\r\n                    <ResponsiveContainer width=\"100%\" height={200}>\r\n                        <BarChart data={monthlyData}>\r\n                            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"var(--color-border)\" />\r\n                            <XAxis dataKey=\"name\" stroke=\"var(--color-text-tertiary)\" fontSize={12} />\r\n                            <YAxis stroke=\"var(--color-text-tertiary)\" fontSize={12} />\r\n                            <Tooltip\r\n                                contentStyle={{\r\n                                    backgroundColor: 'var(--color-surface)',\r\n                                    border: '1px solid var(--color-border)',\r\n                                    borderRadius: '8px',\r\n                                }}\r\n                            />\r\n                            <Bar dataKey=\"ingresos\" fill=\"#10B981\" radius={[4, 4, 0, 0]} />\r\n                            <Bar dataKey=\"gastos\" fill=\"#EF4444\" radius={[4, 4, 0, 0]} />\r\n                        </BarChart>\r\n                    </ResponsiveContainer>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Recent Transactions */}\r\n            <div className=\"recent-section\">\r\n                <div className=\"section-header\">\r\n                    <h3>Transacciones Recientes</h3>\r\n                    <Link to=\"/transacciones\" className=\"view-all-link\">\r\n                        Ver todas <ArrowUpRight size={16} />\r\n                    </Link>\r\n                </div>\r\n                {transactions.length > 0 ? (\r\n                    <div className=\"transactions-list\">\r\n                        {transactions.slice(0, 5).map((tx) => {\r\n                            const category = categories.find((c) => c.id === tx.category_id);\r\n                            return (\r\n                                <div key={tx.id} className=\"transaction-item\">\r\n                                    <div\r\n                                        className=\"tx-icon\"\r\n                                        style={{ backgroundColor: category?.color || '#6B7280' }}\r\n                                    >\r\n                                        {tx.type === 'income' ? (\r\n                                            <ArrowUpRight size={16} color=\"white\" />\r\n                                        ) : (\r\n                                            <ArrowDownRight size={16} color=\"white\" />\r\n                                        )}\r\n                                    </div>\r\n                                    <div className=\"tx-details\">\r\n                                        <span className=\"tx-description\">\r\n                                            {tx.description || category?.name || 'Transacci√≥n'}\r\n                                        </span>\r\n                                        <span className=\"tx-date\">\r\n                                            {format(new Date(tx.date), 'd MMM yyyy', { locale: es })}\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className={`tx-amount ${tx.type}`}>\r\n                                        {tx.type === 'income' ? '+' : '-'}{currency} {Number(tx.amount).toLocaleString()}\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                ) : (\r\n                    <p className=\"no-data\">\r\n                        No hay transacciones este mes.{' '}\r\n                        <Link to=\"/transacciones\">Registra tu primera transacci√≥n</Link>\r\n                    </p>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Login.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Metas.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Metas.tsx:51:19\n  49 |\n  50 |     useEffect(() => {\n> 51 |         if (user) fetchGoals();\n     |                   ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  52 |     }, [user, fetchGoals]);\n  53 |\n  54 |     const handleSubmit = async (e: React.FormEvent) => {","line":51,"column":19,"nodeType":null,"endLine":51,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { Plus, Edit2, Trash2, X, Target, Shield, GraduationCap, ShoppingBag, TrendingUp, Coins } from 'lucide-react';\r\nimport { supabase } from '../lib/supabase';\r\nimport type { Goal } from '../lib/supabase';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { format } from 'date-fns';\r\nimport { es } from 'date-fns/locale';\r\nimport './Metas.css';\r\n\r\nconst GOAL_TYPES = [\r\n    { value: 'emergency_fund', label: 'Fondo de Emergencia', icon: Shield, color: '#10B981' },\r\n    { value: 'savings', label: 'Ahorro General', icon: Coins, color: '#3B82F6' },\r\n    { value: 'purchase', label: 'Compra', icon: ShoppingBag, color: '#F59E0B' },\r\n    { value: 'education', label: 'Educaci√≥n', icon: GraduationCap, color: '#8B5CF6' },\r\n    { value: 'investment', label: 'Inversi√≥n', icon: TrendingUp, color: '#EC4899' },\r\n    { value: 'other', label: 'Otro', icon: Target, color: '#6B7280' },\r\n];\r\n\r\nexport function Metas() {\r\n    const { user, profile } = useAuth();\r\n    const [goals, setGoals] = useState<Goal[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [showContributeModal, setShowContributeModal] = useState(false);\r\n    const [selectedGoal, setSelectedGoal] = useState<Goal | null>(null);\r\n    const [contributionAmount, setContributionAmount] = useState('');\r\n\r\n    const [formData, setFormData] = useState({\r\n        name: '',\r\n        description: '',\r\n        target_amount: '',\r\n        target_date: '',\r\n        goal_type: 'savings',\r\n        priority: 1,\r\n    });\r\n\r\n    const currency = profile?.currency || 'USD';\r\n\r\n    const fetchGoals = useCallback(async () => {\r\n        if (!user) return;\r\n        const { data } = await supabase\r\n            .from('goals')\r\n            .select('*')\r\n            .eq('user_id', user.id)\r\n            .order('priority', { ascending: true });\r\n        setGoals(data || []);\r\n        setLoading(false);\r\n    }, [user]);\r\n\r\n    useEffect(() => {\r\n        if (user) fetchGoals();\r\n    }, [user, fetchGoals]);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        const goalType = GOAL_TYPES.find(t => t.value === formData.goal_type);\r\n\r\n        const data = {\r\n            user_id: user!.id,\r\n            name: formData.name,\r\n            description: formData.description || null,\r\n            target_amount: parseFloat(formData.target_amount),\r\n            target_date: formData.target_date || null,\r\n            goal_type: formData.goal_type,\r\n            priority: formData.priority,\r\n            icon: goalType?.icon.name || 'target',\r\n            color: goalType?.color || '#6B7280',\r\n        };\r\n\r\n        if (selectedGoal) {\r\n            await supabase.from('goals').update(data).eq('id', selectedGoal.id);\r\n        } else {\r\n            await supabase.from('goals').insert(data);\r\n        }\r\n\r\n        closeModal();\r\n        fetchGoals();\r\n    };\r\n\r\n    const handleContribute = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!selectedGoal) return;\r\n\r\n        const amount = parseFloat(contributionAmount);\r\n        const newAmount = Number(selectedGoal.current_amount) + amount;\r\n\r\n        await supabase\r\n            .from('goals')\r\n            .update({\r\n                current_amount: newAmount,\r\n                status: newAmount >= Number(selectedGoal.target_amount) ? 'completed' : 'active',\r\n                completed_at: newAmount >= Number(selectedGoal.target_amount) ? new Date().toISOString() : null,\r\n            })\r\n            .eq('id', selectedGoal.id);\r\n\r\n        await supabase.from('goal_contributions').insert({\r\n            goal_id: selectedGoal.id,\r\n            amount,\r\n            date: format(new Date(), 'yyyy-MM-dd'),\r\n        });\r\n\r\n        setShowContributeModal(false);\r\n        setContributionAmount('');\r\n        setSelectedGoal(null);\r\n        fetchGoals();\r\n    };\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (confirm('¬øEliminar esta meta?')) {\r\n            await supabase.from('goals').delete().eq('id', id);\r\n            fetchGoals();\r\n        }\r\n    };\r\n\r\n    const closeModal = () => {\r\n        setShowModal(false);\r\n        setSelectedGoal(null);\r\n        setFormData({ name: '', description: '', target_amount: '', target_date: '', goal_type: 'savings', priority: 1 });\r\n    };\r\n\r\n    const openEdit = (goal: Goal) => {\r\n        setSelectedGoal(goal);\r\n        setFormData({\r\n            name: goal.name,\r\n            description: goal.description || '',\r\n            target_amount: goal.target_amount.toString(),\r\n            target_date: goal.target_date || '',\r\n            goal_type: goal.goal_type,\r\n            priority: goal.priority,\r\n        });\r\n        setShowModal(true);\r\n    };\r\n\r\n    const activeGoals = goals.filter(g => g.status === 'active');\r\n    const completedGoals = goals.filter(g => g.status === 'completed');\r\n\r\n    if (loading) {\r\n        return <div className=\"loading-container\"><div className=\"loading-spinner\"></div></div>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"metas-page animate-fadeIn\">\r\n            <div className=\"toolbar\">\r\n                <div>\r\n                    <h2>Tus Metas Financieras</h2>\r\n                    <p className=\"text-secondary\">Define y alcanza tus objetivos paso a paso</p>\r\n                </div>\r\n                <button className=\"btn btn-primary\" onClick={() => { setSelectedGoal(null); setShowModal(true); }}>\r\n                    <Plus size={18} />\r\n                    Nueva Meta\r\n                </button>\r\n            </div>\r\n\r\n            {/* Active Goals */}\r\n            <section className=\"goals-section\">\r\n                <h3>Metas Activas ({activeGoals.length})</h3>\r\n                <div className=\"goals-grid\">\r\n                    {activeGoals.length > 0 ? (\r\n                        activeGoals.map((goal) => {\r\n                            const progress = (Number(goal.current_amount) / Number(goal.target_amount)) * 100;\r\n                            const GoalIcon = GOAL_TYPES.find(t => t.value === goal.goal_type)?.icon || Target;\r\n\r\n                            return (\r\n                                <div key={goal.id} className=\"goal-card\">\r\n                                    <div className=\"goal-header\">\r\n                                        <div className=\"goal-icon\" style={{ backgroundColor: goal.color }}>\r\n                                            <GoalIcon size={24} color=\"white\" />\r\n                                        </div>\r\n                                        <div className=\"goal-actions\">\r\n                                            <button className=\"btn btn-icon btn-ghost\" onClick={() => openEdit(goal)}>\r\n                                                <Edit2 size={14} />\r\n                                            </button>\r\n                                            <button className=\"btn btn-icon btn-ghost\" onClick={() => handleDelete(goal.id)}>\r\n                                                <Trash2 size={14} />\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <h4 className=\"goal-name\">{goal.name}</h4>\r\n                                    {goal.description && <p className=\"goal-description\">{goal.description}</p>}\r\n\r\n                                    <div className=\"goal-progress-section\">\r\n                                        <div className=\"goal-amounts\">\r\n                                            <span className=\"current\">{currency} {Number(goal.current_amount).toLocaleString()}</span>\r\n                                            <span className=\"target\">/ {currency} {Number(goal.target_amount).toLocaleString()}</span>\r\n                                        </div>\r\n                                        <div className=\"progress\">\r\n                                            <div className=\"progress-bar progress-success\" style={{ width: `${Math.min(progress, 100)}%` }}></div>\r\n                                        </div>\r\n                                        <span className=\"percentage\">{progress.toFixed(0)}% completado</span>\r\n                                    </div>\r\n\r\n                                    {goal.target_date && (\r\n                                        <p className=\"goal-date\">\r\n                                            Meta: {format(new Date(goal.target_date), 'd MMM yyyy', { locale: es })}\r\n                                        </p>\r\n                                    )}\r\n\r\n                                    <button\r\n                                        className=\"btn btn-primary w-full\"\r\n                                        onClick={() => { setSelectedGoal(goal); setShowContributeModal(true); }}\r\n                                    >\r\n                                        Aportar\r\n                                    </button>\r\n                                </div>\r\n                            );\r\n                        })\r\n                    ) : (\r\n                        <div className=\"empty-state\">\r\n                            <p>No tienes metas activas. ¬°Crea tu primera meta!</p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </section>\r\n\r\n            {/* Completed Goals */}\r\n            {completedGoals.length > 0 && (\r\n                <section className=\"goals-section\">\r\n                    <h3>Metas Completadas ({completedGoals.length}) üéâ</h3>\r\n                    <div className=\"goals-grid\">\r\n                        {completedGoals.map((goal) => (\r\n                            <div key={goal.id} className=\"goal-card completed\">\r\n                                <div className=\"goal-header\">\r\n                                    <div className=\"goal-icon\" style={{ backgroundColor: goal.color }}>\r\n                                        <Target size={24} color=\"white\" />\r\n                                    </div>\r\n                                </div>\r\n                                <h4 className=\"goal-name\">{goal.name}</h4>\r\n                                <p className=\"goal-completed-text\">\r\n                                    ¬°Meta alcanzada! {currency} {Number(goal.target_amount).toLocaleString()}\r\n                                </p>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </section>\r\n            )}\r\n\r\n            {/* New/Edit Goal Modal */}\r\n            {showModal && (\r\n                <div className=\"modal-overlay\" onClick={closeModal}>\r\n                    <div className=\"modal\" onClick={(e) => e.stopPropagation()}>\r\n                        <div className=\"modal-header\">\r\n                            <h2>{selectedGoal ? 'Editar Meta' : 'Nueva Meta'}</h2>\r\n                            <button className=\"btn btn-icon btn-ghost\" onClick={closeModal}><X size={20} /></button>\r\n                        </div>\r\n                        <form onSubmit={handleSubmit} className=\"modal-body\">\r\n                            <div className=\"form-group\">\r\n                                <label className=\"form-label\">Tipo de meta</label>\r\n                                <div className=\"goal-type-grid\">\r\n                                    {GOAL_TYPES.map((type) => (\r\n                                        <button\r\n                                            key={type.value}\r\n                                            type=\"button\"\r\n                                            className={`goal-type-btn ${formData.goal_type === type.value ? 'selected' : ''}`}\r\n                                            onClick={() => setFormData(p => ({ ...p, goal_type: type.value }))}\r\n                                            style={{ '--accent-color': type.color } as React.CSSProperties}\r\n                                        >\r\n                                            <type.icon size={20} />\r\n                                            <span>{type.label}</span>\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"form-group\">\r\n                                <label className=\"form-label\">Nombre de la meta</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className=\"form-input\"\r\n                                    value={formData.name}\r\n                                    onChange={(e) => setFormData(p => ({ ...p, name: e.target.value }))}\r\n                                    placeholder=\"Ej: Fondo de emergencia 3 meses\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"form-group\">\r\n                                <label className=\"form-label\">Monto objetivo ({currency})</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    className=\"form-input\"\r\n                                    value={formData.target_amount}\r\n                                    onChange={(e) => setFormData(p => ({ ...p, target_amount: e.target.value }))}\r\n                                    placeholder=\"0.00\"\r\n                                    min=\"0\"\r\n                                    step=\"0.01\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"form-group\">\r\n                                <label className=\"form-label\">Fecha objetivo (opcional)</label>\r\n                                <input\r\n                                    type=\"date\"\r\n                                    className=\"form-input\"\r\n                                    value={formData.target_date}\r\n                                    onChange={(e) => setFormData(p => ({ ...p, target_date: e.target.value }))}\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"form-group\">\r\n                                <label className=\"form-label\">Descripci√≥n (opcional)</label>\r\n                                <textarea\r\n                                    className=\"form-textarea\"\r\n                                    value={formData.description}\r\n                                    onChange={(e) => setFormData(p => ({ ...p, description: e.target.value }))}\r\n                                    placeholder=\"¬øPor qu√© es importante esta meta para ti?\"\r\n                                    rows={2}\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"modal-actions\">\r\n                                <button type=\"button\" className=\"btn btn-secondary\" onClick={closeModal}>Cancelar</button>\r\n                                <button type=\"submit\" className=\"btn btn-primary\">{selectedGoal ? 'Guardar' : 'Crear Meta'}</button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Contribute Modal */}\r\n            {showContributeModal && selectedGoal && (\r\n                <div className=\"modal-overlay\" onClick={() => setShowContributeModal(false)}>\r\n                    <div className=\"modal small\" onClick={(e) => e.stopPropagation()}>\r\n                        <div className=\"modal-header\">\r\n                            <h2>Aportar a \"{selectedGoal.name}\"</h2>\r\n                            <button className=\"btn btn-icon btn-ghost\" onClick={() => setShowContributeModal(false)}><X size={20} /></button>\r\n                        </div>\r\n                        <form onSubmit={handleContribute} className=\"modal-body\">\r\n                            <div className=\"contribute-info\">\r\n                                <p>Progreso actual: {currency} {Number(selectedGoal.current_amount).toLocaleString()} / {currency} {Number(selectedGoal.target_amount).toLocaleString()}</p>\r\n                                <p>Faltan: {currency} {(Number(selectedGoal.target_amount) - Number(selectedGoal.current_amount)).toLocaleString()}</p>\r\n                            </div>\r\n                            <div className=\"form-group\">\r\n                                <label className=\"form-label\">Monto a aportar ({currency})</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    className=\"form-input amount-input\"\r\n                                    value={contributionAmount}\r\n                                    onChange={(e) => setContributionAmount(e.target.value)}\r\n                                    placeholder=\"0.00\"\r\n                                    min=\"0.01\"\r\n                                    step=\"0.01\"\r\n                                    required\r\n                                    autoFocus\r\n                                />\r\n                            </div>\r\n                            <div className=\"modal-actions\">\r\n                                <button type=\"button\" className=\"btn btn-secondary\" onClick={() => setShowContributeModal(false)}>Cancelar</button>\r\n                                <button type=\"submit\" className=\"btn btn-primary\">Aportar</button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Onboarding.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Presupuestos.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Presupuestos.tsx:51:19\n  49 |\n  50 |     useEffect(() => {\n> 51 |         if (user) fetchData();\n     |                   ^^^^^^^^^ Avoid calling setState() directly within an effect\n  52 |     }, [user, fetchData]);\n  53 |\n  54 |     const handleSubmit = async (e: React.FormEvent) => {","line":51,"column":19,"nodeType":null,"endLine":51,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { Plus, Edit2, Trash2, X } from 'lucide-react';\r\nimport { supabase } from '../lib/supabase';\r\nimport type { Budget, Category, Transaction } from '../lib/supabase';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { format, startOfMonth, endOfMonth } from 'date-fns';\r\nimport './Presupuestos.css';\r\n\r\nexport function Presupuestos() {\r\n    const { user, profile } = useAuth();\r\n    const [budgets, setBudgets] = useState<Budget[]>([]);\r\n    const [categories, setCategories] = useState<Category[]>([]);\r\n    const [transactions, setTransactions] = useState<Transaction[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [editingBudget, setEditingBudget] = useState<Budget | null>(null);\r\n\r\n    const [formData, setFormData] = useState({\r\n        category_id: '',\r\n        amount: '',\r\n        period: 'monthly' as 'weekly' | 'monthly' | 'yearly',\r\n    });\r\n\r\n    const currency = profile?.currency || 'USD';\r\n\r\n    const fetchData = useCallback(async () => {\r\n        if (!user) return;\r\n        const now = new Date();\r\n        const monthStart = startOfMonth(now);\r\n        const monthEnd = endOfMonth(now);\r\n\r\n        const [budgetsRes, categoriesRes, transactionsRes] = await Promise.all([\r\n            supabase.from('budgets').select('*').eq('user_id', user.id),\r\n            supabase.from('categories').select('*').or(`user_id.eq.${user.id},is_system.eq.true`),\r\n            supabase\r\n                .from('transactions')\r\n                .select('*')\r\n                .eq('user_id', user.id)\r\n                .eq('type', 'expense')\r\n                .gte('date', format(monthStart, 'yyyy-MM-dd'))\r\n                .lte('date', format(monthEnd, 'yyyy-MM-dd')),\r\n        ]);\r\n\r\n        setBudgets(budgetsRes.data || []);\r\n        setCategories(categoriesRes.data || []);\r\n        setTransactions(transactionsRes.data || []);\r\n        setLoading(false);\r\n    }, [user]);\r\n\r\n    useEffect(() => {\r\n        if (user) fetchData();\r\n    }, [user, fetchData]);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        const data = {\r\n            user_id: user!.id,\r\n            category_id: formData.category_id || null,\r\n            amount: parseFloat(formData.amount),\r\n            period: formData.period,\r\n        };\r\n\r\n        if (editingBudget) {\r\n            await supabase.from('budgets').update(data).eq('id', editingBudget.id);\r\n        } else {\r\n            await supabase.from('budgets').insert(data);\r\n        }\r\n\r\n        setShowModal(false);\r\n        setEditingBudget(null);\r\n        setFormData({ category_id: '', amount: '', period: 'monthly' });\r\n        fetchData();\r\n    };\r\n\r\n    const handleEdit = (budget: Budget) => {\r\n        setEditingBudget(budget);\r\n        setFormData({\r\n            category_id: budget.category_id || '',\r\n            amount: budget.amount.toString(),\r\n            period: budget.period,\r\n        });\r\n        setShowModal(true);\r\n    };\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (confirm('¬øEliminar este presupuesto?')) {\r\n            await supabase.from('budgets').delete().eq('id', id);\r\n            fetchData();\r\n        }\r\n    };\r\n\r\n    const getBudgetData = () => {\r\n        return budgets.map((budget) => {\r\n            const category = categories.find((c) => c.id === budget.category_id);\r\n            const spent = transactions\r\n                .filter((t) => t.category_id === budget.category_id)\r\n                .reduce((sum, t) => sum + Number(t.amount), 0);\r\n            const percentage = (spent / Number(budget.amount)) * 100;\r\n            const status = percentage <= 80 ? 'success' : percentage <= 100 ? 'warning' : 'danger';\r\n            const remaining = Number(budget.amount) - spent;\r\n\r\n            return {\r\n                ...budget,\r\n                category,\r\n                spent,\r\n                percentage,\r\n                status,\r\n                remaining,\r\n            };\r\n        });\r\n    };\r\n\r\n    const budgetData = getBudgetData();\r\n    const totalBudget = budgets.reduce((sum, b) => sum + Number(b.amount), 0);\r\n    const totalSpent = budgetData.reduce((sum, b) => sum + b.spent, 0);\r\n    const totalPercentage = totalBudget > 0 ? (totalSpent / totalBudget) * 100 : 0;\r\n\r\n    if (loading) {\r\n        return <div className=\"loading-container\"><div className=\"loading-spinner\"></div></div>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"presupuestos-page animate-fadeIn\">\r\n            {/* Total Budget Overview */}\r\n            <div className=\"budget-overview\">\r\n                <div className=\"overview-header\">\r\n                    <h2>Presupuesto Total Mensual</h2>\r\n                    <span className={`overview-status status-${totalPercentage <= 80 ? 'success' : totalPercentage <= 100 ? 'warning' : 'danger'}`}>\r\n                        {totalPercentage.toFixed(0)}% usado\r\n                    </span>\r\n                </div>\r\n                <div className=\"overview-amounts\">\r\n                    <span className=\"spent\">{currency} {totalSpent.toLocaleString()} gastado</span>\r\n                    <span className=\"total\">de {currency} {totalBudget.toLocaleString()}</span>\r\n                </div>\r\n                <div className=\"progress large\">\r\n                    <div\r\n                        className={`progress-bar progress-${totalPercentage <= 80 ? 'success' : totalPercentage <= 100 ? 'warning' : 'danger'}`}\r\n                        style={{ width: `${Math.min(totalPercentage, 100)}%` }}\r\n                    ></div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Actions */}\r\n            <div className=\"toolbar\">\r\n                <h3>Presupuestos por Categor√≠a</h3>\r\n                <button className=\"btn btn-primary\" onClick={() => { setEditingBudget(null); setFormData({ category_id: '', amount: '', period: 'monthly' }); setShowModal(true); }}>\r\n                    <Plus size={18} />\r\n                    Nuevo Presupuesto\r\n                </button>\r\n            </div>\r\n\r\n            {/* Budget Cards */}\r\n            <div className=\"budgets-grid\">\r\n                {budgetData.length > 0 ? (\r\n                    budgetData.map((budget) => (\r\n                        <div key={budget.id} className={`budget-card status-${budget.status}`}>\r\n                            <div className=\"budget-header\">\r\n                                <div className=\"budget-category\">\r\n                                    <span\r\n                                        className=\"category-dot\"\r\n                                        style={{ backgroundColor: budget.category?.color || '#6B7280' }}\r\n                                    ></span>\r\n                                    <span>{budget.category?.name || 'General'}</span>\r\n                                </div>\r\n                                <div className=\"budget-actions\">\r\n                                    <button className=\"btn btn-icon btn-ghost\" onClick={() => handleEdit(budget)}>\r\n                                        <Edit2 size={14} />\r\n                                    </button>\r\n                                    <button className=\"btn btn-icon btn-ghost\" onClick={() => handleDelete(budget.id)}>\r\n                                        <Trash2 size={14} />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"budget-amounts\">\r\n                                <span className=\"amount-spent\">{currency} {budget.spent.toLocaleString()}</span>\r\n                                <span className=\"amount-total\">/ {currency} {Number(budget.amount).toLocaleString()}</span>\r\n                            </div>\r\n\r\n                            <div className=\"progress\">\r\n                                <div\r\n                                    className={`progress-bar progress-${budget.status}`}\r\n                                    style={{ width: `${Math.min(budget.percentage, 100)}%` }}\r\n                                ></div>\r\n                            </div>\r\n\r\n                            <div className=\"budget-footer\">\r\n                                <span className={`remaining ${budget.remaining >= 0 ? 'positive' : 'negative'}`}>\r\n                                    {budget.remaining >= 0\r\n                                        ? `${currency} ${budget.remaining.toLocaleString()} disponible`\r\n                                        : `${currency} ${Math.abs(budget.remaining).toLocaleString()} excedido`}\r\n                                </span>\r\n                                <span className=\"percentage\">{budget.percentage.toFixed(0)}%</span>\r\n                            </div>\r\n                        </div>\r\n                    ))\r\n                ) : (\r\n                    <div className=\"empty-state\">\r\n                        <p>No tienes presupuestos configurados.</p>\r\n                        <button className=\"btn btn-primary\" onClick={() => setShowModal(true)}>\r\n                            Crear primer presupuesto\r\n                        </button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Modal */}\r\n            {showModal && (\r\n                <div className=\"modal-overlay\" onClick={() => setShowModal(false)}>\r\n                    <div className=\"modal\" onClick={(e) => e.stopPropagation()}>\r\n                        <div className=\"modal-header\">\r\n                            <h2>{editingBudget ? 'Editar Presupuesto' : 'Nuevo Presupuesto'}</h2>\r\n                            <button className=\"btn btn-icon btn-ghost\" onClick={() => setShowModal(false)}>\r\n                                <X size={20} />\r\n                            </button>\r\n                        </div>\r\n                        <form onSubmit={handleSubmit} className=\"modal-body\">\r\n                            <div className=\"form-group\">\r\n                                <label className=\"form-label\">Categor√≠a</label>\r\n                                <select\r\n                                    className=\"form-select\"\r\n                                    value={formData.category_id}\r\n                                    onChange={(e) => setFormData((p) => ({ ...p, category_id: e.target.value }))}\r\n                                    required\r\n                                >\r\n                                    <option value=\"\">Seleccionar categor√≠a</option>\r\n                                    {categories\r\n                                        .filter((c) => c.type === 'expense' || c.type === 'both')\r\n                                        .map((cat) => (\r\n                                            <option key={cat.id} value={cat.id}>{cat.name}</option>\r\n                                        ))}\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div className=\"form-group\">\r\n                                <label className=\"form-label\">Monto ({currency})</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    className=\"form-input\"\r\n                                    value={formData.amount}\r\n                                    onChange={(e) => setFormData((p) => ({ ...p, amount: e.target.value }))}\r\n                                    placeholder=\"0.00\"\r\n                                    min=\"0\"\r\n                                    step=\"0.01\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"modal-actions\">\r\n                                <button type=\"button\" className=\"btn btn-secondary\" onClick={() => setShowModal(false)}>\r\n                                    Cancelar\r\n                                </button>\r\n                                <button type=\"submit\" className=\"btn btn-primary\">\r\n                                    {editingBudget ? 'Guardar' : 'Crear Presupuesto'}\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Reportes.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`fetchData` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nD:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Reportes.tsx:39:19\n  37 |\n  38 |     useEffect(() => {\n> 39 |         if (user) fetchData();\n     |                   ^^^^^^^^^ `fetchData` accessed before it is declared\n  40 |     }, [user, selectedMonth]);\n  41 |\n  42 |     const fetchData = async () => {\n\nD:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Reportes.tsx:42:5\n  40 |     }, [user, selectedMonth]);\n  41 |\n> 42 |     const fetchData = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 43 |         const monthStart = startOfMonth(selectedMonth);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 44 |         const monthEnd = endOfMonth(selectedMonth);\n     ‚Ä¶\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 58 |         setLoading(false);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 59 |     };\n     | ^^^^^^^ `fetchData` is declared here\n  60 |\n  61 |     const income = transactions.filter(t => t.type === 'income').reduce((s, t) => s + Number(t.amount), 0);\n  62 |     const expenses = transactions.filter(t => t.type === 'expense').reduce((s, t) => s + Number(t.amount), 0);","line":39,"column":19,"nodeType":null,"endLine":39,"endColumn":28},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":40,"column":8,"nodeType":"ArrayExpression","endLine":40,"endColumn":29,"suggestions":[{"desc":"Update the dependencies array to be: [user, selectedMonth, fetchData]","fix":{"range":[1118,1139],"text":"[user, selectedMonth, fetchData]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport {\r\n    Download,\r\n    TrendingUp,\r\n    TrendingDown,\r\n    Calendar,\r\n    ChevronLeft,\r\n    ChevronRight,\r\n} from 'lucide-react';\r\nimport {\r\n    BarChart,\r\n    Bar,\r\n    XAxis,\r\n    YAxis,\r\n    CartesianGrid,\r\n    Tooltip,\r\n    ResponsiveContainer,\r\n    PieChart,\r\n    Pie,\r\n    Cell,\r\n} from 'recharts';\r\nimport { supabase } from '../lib/supabase';\r\nimport type { Transaction, Category } from '../lib/supabase';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { format, startOfMonth, endOfMonth, subMonths, addMonths } from 'date-fns';\r\nimport { es } from 'date-fns/locale';\r\nimport './Reportes.css';\r\n\r\nexport function Reportes() {\r\n    const { user, profile } = useAuth();\r\n    const [transactions, setTransactions] = useState<Transaction[]>([]);\r\n    const [categories, setCategories] = useState<Category[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [selectedMonth, setSelectedMonth] = useState(new Date());\r\n\r\n    const currency = profile?.currency || 'USD';\r\n\r\n    useEffect(() => {\r\n        if (user) fetchData();\r\n    }, [user, selectedMonth]);\r\n\r\n    const fetchData = async () => {\r\n        const monthStart = startOfMonth(selectedMonth);\r\n        const monthEnd = endOfMonth(selectedMonth);\r\n\r\n        const [txRes, catRes] = await Promise.all([\r\n            supabase\r\n                .from('transactions')\r\n                .select('*')\r\n                .eq('user_id', user!.id)\r\n                .gte('date', format(monthStart, 'yyyy-MM-dd'))\r\n                .lte('date', format(monthEnd, 'yyyy-MM-dd')),\r\n            supabase.from('categories').select('*').or(`user_id.eq.${user!.id},is_system.eq.true`),\r\n        ]);\r\n\r\n        setTransactions(txRes.data || []);\r\n        setCategories(catRes.data || []);\r\n        setLoading(false);\r\n    };\r\n\r\n    const income = transactions.filter(t => t.type === 'income').reduce((s, t) => s + Number(t.amount), 0);\r\n    const expenses = transactions.filter(t => t.type === 'expense').reduce((s, t) => s + Number(t.amount), 0);\r\n    const savings = income - expenses;\r\n    const savingsRate = income > 0 ? (savings / income) * 100 : 0;\r\n\r\n    // Category breakdown\r\n    const categoryData = transactions\r\n        .filter(t => t.type === 'expense')\r\n        .reduce((acc: Record<string, number>, t) => {\r\n            const catId = t.category_id || 'other';\r\n            acc[catId] = (acc[catId] || 0) + Number(t.amount);\r\n            return acc;\r\n        }, {});\r\n\r\n    const topCategories = Object.entries(categoryData)\r\n        .map(([id, amount]) => {\r\n            const cat = categories.find(c => c.id === id);\r\n            return { name: cat?.name || 'Otros', amount, color: cat?.color || '#6B7280' };\r\n        })\r\n        .sort((a, b) => b.amount - a.amount)\r\n        .slice(0, 5);\r\n\r\n    // Bar chart data for expense distribution\r\n    const barData = topCategories.map(c => ({ name: c.name, monto: c.amount }));\r\n\r\n    // Export to CSV\r\n    const exportCSV = () => {\r\n        const headers = ['Fecha', 'Tipo', 'Categor√≠a', 'Descripci√≥n', 'Monto'];\r\n        const rows = transactions.map(t => {\r\n            const cat = categories.find(c => c.id === t.category_id);\r\n            return [\r\n                t.date,\r\n                t.type === 'income' ? 'Ingreso' : 'Gasto',\r\n                cat?.name || '',\r\n                t.description || '',\r\n                t.amount,\r\n            ].join(',');\r\n        });\r\n\r\n        const csv = [headers.join(','), ...rows].join('\\n');\r\n        const blob = new Blob([csv], { type: 'text/csv' });\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = `bc-money-reporte-${format(selectedMonth, 'yyyy-MM')}.csv`;\r\n        a.click();\r\n    };\r\n\r\n    if (loading) {\r\n        return <div className=\"loading-container\"><div className=\"loading-spinner\"></div></div>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"reportes-page animate-fadeIn\">\r\n            {/* Header */}\r\n            <div className=\"report-header\">\r\n                <div className=\"month-selector\">\r\n                    <button className=\"btn btn-icon btn-ghost\" onClick={() => setSelectedMonth(subMonths(selectedMonth, 1))}>\r\n                        <ChevronLeft size={20} />\r\n                    </button>\r\n                    <div className=\"current-month\">\r\n                        <Calendar size={18} />\r\n                        <span>{format(selectedMonth, 'MMMM yyyy', { locale: es })}</span>\r\n                    </div>\r\n                    <button\r\n                        className=\"btn btn-icon btn-ghost\"\r\n                        onClick={() => setSelectedMonth(addMonths(selectedMonth, 1))}\r\n                        disabled={selectedMonth >= startOfMonth(new Date())}\r\n                    >\r\n                        <ChevronRight size={20} />\r\n                    </button>\r\n                </div>\r\n                <button className=\"btn btn-secondary\" onClick={exportCSV}>\r\n                    <Download size={18} />\r\n                    Exportar CSV\r\n                </button>\r\n            </div>\r\n\r\n            {/* Summary Cards */}\r\n            <div className=\"summary-grid\">\r\n                <div className=\"summary-card\">\r\n                    <div className=\"summary-icon income\"><TrendingUp size={24} /></div>\r\n                    <div className=\"summary-content\">\r\n                        <span className=\"label\">Ingresos Totales</span>\r\n                        <span className=\"value\">{currency} {income.toLocaleString()}</span>\r\n                    </div>\r\n                </div>\r\n                <div className=\"summary-card\">\r\n                    <div className=\"summary-icon expense\"><TrendingDown size={24} /></div>\r\n                    <div className=\"summary-content\">\r\n                        <span className=\"label\">Gastos Totales</span>\r\n                        <span className=\"value\">{currency} {expenses.toLocaleString()}</span>\r\n                    </div>\r\n                </div>\r\n                <div className=\"summary-card\">\r\n                    <div className={`summary-icon ${savings >= 0 ? 'savings' : 'negative'}`}>\r\n                        {savings >= 0 ? <TrendingUp size={24} /> : <TrendingDown size={24} />}\r\n                    </div>\r\n                    <div className=\"summary-content\">\r\n                        <span className=\"label\">Ahorro</span>\r\n                        <span className={`value ${savings >= 0 ? 'positive' : 'negative'}`}>\r\n                            {currency} {savings.toLocaleString()}\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n                <div className=\"summary-card\">\r\n                    <div className={`summary-icon ${savingsRate >= 20 ? 'savings' : savingsRate >= 0 ? 'warning' : 'negative'}`}>\r\n                        <span className=\"rate-icon\">%</span>\r\n                    </div>\r\n                    <div className=\"summary-content\">\r\n                        <span className=\"label\">Tasa de Ahorro</span>\r\n                        <span className={`value ${savingsRate >= 20 ? 'positive' : savingsRate >= 0 ? '' : 'negative'}`}>\r\n                            {savingsRate.toFixed(1)}%\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Charts */}\r\n            <div className=\"charts-row\">\r\n                <div className=\"chart-card\">\r\n                    <h3>Top 5 Categor√≠as de Gasto</h3>\r\n                    {barData.length > 0 ? (\r\n                        <ResponsiveContainer width=\"100%\" height={250}>\r\n                            <BarChart data={barData} layout=\"vertical\">\r\n                                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"var(--color-border)\" />\r\n                                <XAxis type=\"number\" stroke=\"var(--color-text-tertiary)\" fontSize={12} />\r\n                                <YAxis type=\"category\" dataKey=\"name\" stroke=\"var(--color-text-tertiary)\" fontSize={12} width={100} />\r\n                                <Tooltip\r\n                                    contentStyle={{ backgroundColor: 'var(--color-surface)', border: '1px solid var(--color-border)', borderRadius: '8px' }}\r\n                                    formatter={(value: number) => [`${currency} ${value.toLocaleString()}`, 'Monto']}\r\n                                />\r\n                                <Bar dataKey=\"monto\" fill=\"var(--color-primary)\" radius={[0, 4, 4, 0]} />\r\n                            </BarChart>\r\n                        </ResponsiveContainer>\r\n                    ) : (\r\n                        <p className=\"no-data\">No hay gastos este mes</p>\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"chart-card\">\r\n                    <h3>Distribuci√≥n de Gastos</h3>\r\n                    {topCategories.length > 0 ? (\r\n                        <div className=\"pie-container\">\r\n                            <ResponsiveContainer width=\"100%\" height={200}>\r\n                                <PieChart>\r\n                                    <Pie data={topCategories} dataKey=\"amount\" nameKey=\"name\" cx=\"50%\" cy=\"50%\" outerRadius={80} innerRadius={40}>\r\n                                        {topCategories.map((entry, i) => (\r\n                                            <Cell key={i} fill={entry.color} />\r\n                                        ))}\r\n                                    </Pie>\r\n                                    <Tooltip formatter={(v: number) => [`${currency} ${v.toLocaleString()}`, 'Monto']} />\r\n                                </PieChart>\r\n                            </ResponsiveContainer>\r\n                            <div className=\"pie-legend\">\r\n                                {topCategories.map((cat, i) => (\r\n                                    <div key={i} className=\"legend-item\">\r\n                                        <span className=\"legend-color\" style={{ backgroundColor: cat.color }}></span>\r\n                                        <span>{cat.name}</span>\r\n                                        <span className=\"legend-value\">{currency} {cat.amount.toLocaleString()}</span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <p className=\"no-data\">No hay datos para mostrar</p>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Transactions Table */}\r\n            <div className=\"transactions-section\">\r\n                <h3>Detalle de Transacciones ({transactions.length})</h3>\r\n                <div className=\"transactions-table-container\">\r\n                    <table className=\"table\">\r\n                        <thead>\r\n                            <tr>\r\n                                <th>Fecha</th>\r\n                                <th>Descripci√≥n</th>\r\n                                <th>Categor√≠a</th>\r\n                                <th>Tipo</th>\r\n                                <th className=\"text-right\">Monto</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {transactions.length > 0 ? (\r\n                                transactions.map(tx => {\r\n                                    const cat = categories.find(c => c.id === tx.category_id);\r\n                                    return (\r\n                                        <tr key={tx.id}>\r\n                                            <td>{format(new Date(tx.date), 'd MMM', { locale: es })}</td>\r\n                                            <td>{tx.description || '-'}</td>\r\n                                            <td>\r\n                                                <span className=\"category-tag\" style={{ backgroundColor: cat?.color || '#6B7280' }}>\r\n                                                    {cat?.name || 'Sin categor√≠a'}\r\n                                                </span>\r\n                                            </td>\r\n                                            <td>\r\n                                                <span className={`type-badge ${tx.type}`}>\r\n                                                    {tx.type === 'income' ? 'Ingreso' : 'Gasto'}\r\n                                                </span>\r\n                                            </td>\r\n                                            <td className={`text-right amount ${tx.type}`}>\r\n                                                {tx.type === 'income' ? '+' : '-'}{currency} {Number(tx.amount).toLocaleString()}\r\n                                            </td>\r\n                                        </tr>\r\n                                    );\r\n                                })\r\n                            ) : (\r\n                                <tr><td colSpan={5} className=\"text-center\">No hay transacciones este mes</td></tr>\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Signup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Transacciones.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`fetchData` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nD:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Transacciones.tsx:51:13\n  49 |     useEffect(() => {\n  50 |         if (user) {\n> 51 |             fetchData();\n     |             ^^^^^^^^^ `fetchData` accessed before it is declared\n  52 |         }\n  53 |\n  54 |         // Check if opening modal for new transaction\n\nD:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\pages\\Transacciones.tsx:62:5\n  60 |     }, [user, searchParams]);\n  61 |\n> 62 |     const fetchData = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 63 |         const { data: txData } = await supabase\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 64 |             .from('transactions')\n     ‚Ä¶\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 76 |         setLoading(false);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 77 |     };\n     | ^^^^^^^ `fetchData` is declared here\n  78 |\n  79 |     const handleSubmit = async (e: React.FormEvent) => {\n  80 |         e.preventDefault();","line":51,"column":13,"nodeType":null,"endLine":51,"endColumn":22},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":60,"column":8,"nodeType":"ArrayExpression","endLine":60,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [user, searchParams, fetchData]","fix":{"range":[2073,2093],"text":"[user, searchParams, fetchData]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport {\r\n    Plus,\r\n    Search,\r\n    Edit2,\r\n    Trash2,\r\n    ArrowUpRight,\r\n    ArrowDownRight,\r\n    X,\r\n} from 'lucide-react';\r\nimport { supabase } from '../lib/supabase';\r\nimport type { Transaction, Category } from '../lib/supabase';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { format } from 'date-fns';\r\nimport { es } from 'date-fns/locale';\r\nimport { useSearchParams } from 'react-router-dom';\r\nimport './Transacciones.css';\r\n\r\nexport function Transacciones() {\r\n    const { user, profile } = useAuth();\r\n    const [searchParams] = useSearchParams();\r\n    const [transactions, setTransactions] = useState<Transaction[]>([]);\r\n    const [categories, setCategories] = useState<Category[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [editingTx, setEditingTx] = useState<Transaction | null>(null);\r\n\r\n    // Filters\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [typeFilter, setTypeFilter] = useState<string>('all');\r\n    const [categoryFilter, setCategoryFilter] = useState<string>('all');\r\n    const [dateFrom, setDateFrom] = useState('');\r\n    const [dateTo, setDateTo] = useState('');\r\n\r\n    // Form state\r\n    const [formData, setFormData] = useState({\r\n        type: 'expense' as 'income' | 'expense',\r\n        amount: '',\r\n        category_id: '',\r\n        description: '',\r\n        date: format(new Date(), 'yyyy-MM-dd'),\r\n        is_essential: false,\r\n        is_recurring: false,\r\n        payment_method: 'debit' as 'cash' | 'debit' | 'credit' | 'transfer' | 'other',\r\n    });\r\n\r\n    const currency = profile?.currency || 'USD';\r\n\r\n    useEffect(() => {\r\n        if (user) {\r\n            fetchData();\r\n        }\r\n\r\n        // Check if opening modal for new transaction\r\n        const newType = searchParams.get('new');\r\n        if (newType === 'income' || newType === 'expense') {\r\n            setFormData(prev => ({ ...prev, type: newType }));\r\n            setShowModal(true);\r\n        }\r\n    }, [user, searchParams]);\r\n\r\n    const fetchData = async () => {\r\n        const { data: txData } = await supabase\r\n            .from('transactions')\r\n            .select('*')\r\n            .eq('user_id', user!.id)\r\n            .order('date', { ascending: false });\r\n\r\n        const { data: catData } = await supabase\r\n            .from('categories')\r\n            .select('*')\r\n            .or(`user_id.eq.${user!.id},is_system.eq.true`);\r\n\r\n        setTransactions(txData || []);\r\n        setCategories(catData || []);\r\n        setLoading(false);\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        const txData = {\r\n            user_id: user!.id,\r\n            type: formData.type,\r\n            amount: parseFloat(formData.amount),\r\n            category_id: formData.category_id || null,\r\n            description: formData.description || null,\r\n            date: formData.date,\r\n            is_essential: formData.is_essential,\r\n            is_recurring: formData.is_recurring,\r\n            payment_method: formData.payment_method,\r\n        };\r\n\r\n        if (editingTx) {\r\n            await supabase\r\n                .from('transactions')\r\n                .update(txData)\r\n                .eq('id', editingTx.id);\r\n        } else {\r\n            await supabase\r\n                .from('transactions')\r\n                .insert(txData);\r\n        }\r\n\r\n        setShowModal(false);\r\n        setEditingTx(null);\r\n        resetForm();\r\n        fetchData();\r\n    };\r\n\r\n    const handleEdit = (tx: Transaction) => {\r\n        setEditingTx(tx);\r\n        setFormData({\r\n            type: tx.type as 'income' | 'expense',\r\n            amount: tx.amount.toString(),\r\n            category_id: tx.category_id || '',\r\n            description: tx.description || '',\r\n            date: tx.date,\r\n            is_essential: tx.is_essential,\r\n            is_recurring: tx.is_recurring,\r\n            payment_method: tx.payment_method,\r\n        });\r\n        setShowModal(true);\r\n    };\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (confirm('¬øEst√°s seguro de eliminar esta transacci√≥n?')) {\r\n            await supabase\r\n                .from('transactions')\r\n                .delete()\r\n                .eq('id', id);\r\n            fetchData();\r\n        }\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setFormData({\r\n            type: 'expense',\r\n            amount: '',\r\n            category_id: '',\r\n            description: '',\r\n            date: format(new Date(), 'yyyy-MM-dd'),\r\n            is_essential: false,\r\n            is_recurring: false,\r\n            payment_method: 'debit',\r\n        });\r\n    };\r\n\r\n    // Filter transactions\r\n    const filteredTransactions = transactions.filter((tx) => {\r\n        const matchesSearch = !searchTerm ||\r\n            tx.description?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            tx.merchant?.toLowerCase().includes(searchTerm.toLowerCase());\r\n\r\n        const matchesType = typeFilter === 'all' || tx.type === typeFilter;\r\n        const matchesCategory = categoryFilter === 'all' || tx.category_id === categoryFilter;\r\n        const matchesDateFrom = !dateFrom || tx.date >= dateFrom;\r\n        const matchesDateTo = !dateTo || tx.date <= dateTo;\r\n\r\n        return matchesSearch && matchesType && matchesCategory && matchesDateFrom && matchesDateTo;\r\n    });\r\n\r\n    // Calculate totals\r\n    const totalIncome = filteredTransactions\r\n        .filter(t => t.type === 'income')\r\n        .reduce((sum, t) => sum + Number(t.amount), 0);\r\n\r\n    const totalExpense = filteredTransactions\r\n        .filter(t => t.type === 'expense')\r\n        .reduce((sum, t) => sum + Number(t.amount), 0);\r\n\r\n    if (loading) {\r\n        return <div className=\"loading-container\"><div className=\"loading-spinner\"></div></div>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"transacciones-page animate-fadeIn\">\r\n            {/* Summary Cards */}\r\n            <div className=\"summary-row\">\r\n                <div className=\"summary-card income\">\r\n                    <ArrowUpRight size={24} />\r\n                    <div>\r\n                        <span className=\"label\">Ingresos</span>\r\n                        <span className=\"value\">{currency} {totalIncome.toLocaleString()}</span>\r\n                    </div>\r\n                </div>\r\n                <div className=\"summary-card expense\">\r\n                    <ArrowDownRight size={24} />\r\n                    <div>\r\n                        <span className=\"label\">Gastos</span>\r\n                        <span className=\"value\">{currency} {totalExpense.toLocaleString()}</span>\r\n                    </div>\r\n                </div>\r\n                <div className=\"summary-card balance\">\r\n                    <div>\r\n                        <span className=\"label\">Balance</span>\r\n                        <span className={`value ${totalIncome - totalExpense >= 0 ? 'positive' : 'negative'}`}>\r\n                            {currency} {(totalIncome - totalExpense).toLocaleString()}\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filters & Actions */}\r\n            <div className=\"toolbar\">\r\n                <div className=\"search-wrapper\">\r\n                    <Search size={18} className=\"search-icon\" />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Buscar transacciones...\"\r\n                        className=\"search-input\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                    />\r\n                </div>\r\n\r\n                <div className=\"filters\">\r\n                    <select\r\n                        className=\"form-select filter-select\"\r\n                        value={typeFilter}\r\n                        onChange={(e) => setTypeFilter(e.target.value)}\r\n                    >\r\n                        <option value=\"all\">Todos los tipos</option>\r\n                        <option value=\"income\">Ingresos</option>\r\n                        <option value=\"expense\">Gastos</option>\r\n                    </select>\r\n\r\n                    <select\r\n                        className=\"form-select filter-select\"\r\n                        value={categoryFilter}\r\n                        onChange={(e) => setCategoryFilter(e.target.value)}\r\n                    >\r\n                        <option value=\"all\">Todas las categor√≠as</option>\r\n                        {categories\r\n                            .filter(c => typeFilter === 'all' || c.type === typeFilter || c.type === 'both')\r\n                            .map(cat => (\r\n                                <option key={cat.id} value={cat.id}>{cat.name}</option>\r\n                            ))\r\n                        }\r\n                    </select>\r\n\r\n                    <input\r\n                        type=\"date\"\r\n                        className=\"form-input date-input\"\r\n                        value={dateFrom}\r\n                        onChange={(e) => setDateFrom(e.target.value)}\r\n                        placeholder=\"Desde\"\r\n                    />\r\n                    <input\r\n                        type=\"date\"\r\n                        className=\"form-input date-input\"\r\n                        value={dateTo}\r\n                        onChange={(e) => setDateTo(e.target.value)}\r\n                        placeholder=\"Hasta\"\r\n                    />\r\n                </div>\r\n\r\n                <button\r\n                    className=\"btn btn-primary\"\r\n                    onClick={() => {\r\n                        resetForm();\r\n                        setEditingTx(null);\r\n                        setShowModal(true);\r\n                    }}\r\n                >\r\n                    <Plus size={18} />\r\n                    Nueva Transacci√≥n\r\n                </button>\r\n            </div>\r\n\r\n            {/* Transactions Table */}\r\n            <div className=\"transactions-table-container\">\r\n                <table className=\"table\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Fecha</th>\r\n                            <th>Descripci√≥n</th>\r\n                            <th>Categor√≠a</th>\r\n                            <th>Tipo</th>\r\n                            <th className=\"text-right\">Monto</th>\r\n                            <th>Acciones</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {filteredTransactions.length > 0 ? (\r\n                            filteredTransactions.map((tx) => {\r\n                                const category = categories.find(c => c.id === tx.category_id);\r\n                                return (\r\n                                    <tr key={tx.id}>\r\n                                        <td>{format(new Date(tx.date), 'd MMM yyyy', { locale: es })}</td>\r\n                                        <td>\r\n                                            <div className=\"tx-desc\">\r\n                                                {tx.description || 'Sin descripci√≥n'}\r\n                                                {tx.is_recurring && <span className=\"badge badge-info\">Recurrente</span>}\r\n                                            </div>\r\n                                        </td>\r\n                                        <td>\r\n                                            <span\r\n                                                className=\"category-tag\"\r\n                                                style={{ backgroundColor: category?.color || '#6B7280' }}\r\n                                            >\r\n                                                {category?.name || 'Sin categor√≠a'}\r\n                                            </span>\r\n                                        </td>\r\n                                        <td>\r\n                                            <span className={`type-badge ${tx.type}`}>\r\n                                                {tx.type === 'income' ? 'Ingreso' : 'Gasto'}\r\n                                            </span>\r\n                                        </td>\r\n                                        <td className={`text-right amount ${tx.type}`}>\r\n                                            {tx.type === 'income' ? '+' : '-'}{currency} {Number(tx.amount).toLocaleString()}\r\n                                        </td>\r\n                                        <td>\r\n                                            <div className=\"actions\">\r\n                                                <button\r\n                                                    className=\"btn btn-icon btn-ghost\"\r\n                                                    onClick={() => handleEdit(tx)}\r\n                                                >\r\n                                                    <Edit2 size={16} />\r\n                                                </button>\r\n                                                <button\r\n                                                    className=\"btn btn-icon btn-ghost\"\r\n                                                    onClick={() => handleDelete(tx.id)}\r\n                                                >\r\n                                                    <Trash2 size={16} />\r\n                                                </button>\r\n                                            </div>\r\n                                        </td>\r\n                                    </tr>\r\n                                );\r\n                            })\r\n                        ) : (\r\n                            <tr>\r\n                                <td colSpan={6} className=\"text-center\">\r\n                                    No hay transacciones que mostrar\r\n                                </td>\r\n                            </tr>\r\n                        )}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {/* Add/Edit Modal */}\r\n            {showModal && (\r\n                <div className=\"modal-overlay\" onClick={() => setShowModal(false)}>\r\n                    <div className=\"modal\" onClick={e => e.stopPropagation()}>\r\n                        <div className=\"modal-header\">\r\n                            <h2>{editingTx ? 'Editar Transacci√≥n' : 'Nueva Transacci√≥n'}</h2>\r\n                            <button className=\"btn btn-icon btn-ghost\" onClick={() => setShowModal(false)}>\r\n                                <X size={20} />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <form onSubmit={handleSubmit} className=\"modal-body\">\r\n                            <div className=\"type-toggle\">\r\n                                <button\r\n                                    type=\"button\"\r\n                                    className={`toggle-btn ${formData.type === 'income' ? 'active income' : ''}`}\r\n                                    onClick={() => setFormData(prev => ({ ...prev, type: 'income' }))}\r\n                                >\r\n                                    <ArrowUpRight size={18} />\r\n                                    Ingreso\r\n                                </button>\r\n                                <button\r\n                                    type=\"button\"\r\n                                    className={`toggle-btn ${formData.type === 'expense' ? 'active expense' : ''}`}\r\n                                    onClick={() => setFormData(prev => ({ ...prev, type: 'expense' }))}\r\n                                >\r\n                                    <ArrowDownRight size={18} />\r\n                                    Gasto\r\n                                </button>\r\n                            </div>\r\n\r\n                            <div className=\"form-group\">\r\n                                <label className=\"form-label\">Monto ({currency})</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    className=\"form-input amount-input\"\r\n                                    value={formData.amount}\r\n                                    onChange={(e) => setFormData(prev => ({ ...prev, amount: e.target.value }))}\r\n                                    placeholder=\"0.00\"\r\n                                    step=\"0.01\"\r\n                                    min=\"0\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"form-row\">\r\n                                <div className=\"form-group\">\r\n                                    <label className=\"form-label\">Categor√≠a</label>\r\n                                    <select\r\n                                        className=\"form-select\"\r\n                                        value={formData.category_id}\r\n                                        onChange={(e) => setFormData(prev => ({ ...prev, category_id: e.target.value }))}\r\n                                    >\r\n                                        <option value=\"\">Seleccionar categor√≠a</option>\r\n                                        {categories\r\n                                            .filter(c => c.type === formData.type || c.type === 'both')\r\n                                            .map(cat => (\r\n                                                <option key={cat.id} value={cat.id}>{cat.name}</option>\r\n                                            ))\r\n                                        }\r\n                                    </select>\r\n                                </div>\r\n\r\n                                <div className=\"form-group\">\r\n                                    <label className=\"form-label\">Fecha</label>\r\n                                    <input\r\n                                        type=\"date\"\r\n                                        className=\"form-input\"\r\n                                        value={formData.date}\r\n                                        onChange={(e) => setFormData(prev => ({ ...prev, date: e.target.value }))}\r\n                                        required\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"form-group\">\r\n                                <label className=\"form-label\">Descripci√≥n</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className=\"form-input\"\r\n                                    value={formData.description}\r\n                                    onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}\r\n                                    placeholder=\"Descripci√≥n de la transacci√≥n\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"form-group\">\r\n                                <label className=\"form-label\">M√©todo de pago</label>\r\n                                <select\r\n                                    className=\"form-select\"\r\n                                    value={formData.payment_method}\r\n                                    onChange={(e) => setFormData(prev => ({ ...prev, payment_method: e.target.value as typeof formData.payment_method }))}\r\n                                >\r\n                                    <option value=\"debit\">D√©bito</option>\r\n                                    <option value=\"credit\">Cr√©dito</option>\r\n                                    <option value=\"cash\">Efectivo</option>\r\n                                    <option value=\"transfer\">Transferencia</option>\r\n                                    <option value=\"other\">Otro</option>\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div className=\"form-checkboxes\">\r\n                                <label className=\"checkbox-label\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={formData.is_essential}\r\n                                        onChange={(e) => setFormData(prev => ({ ...prev, is_essential: e.target.checked }))}\r\n                                    />\r\n                                    <span>Es un gasto esencial (necesidad)</span>\r\n                                </label>\r\n\r\n                                <label className=\"checkbox-label\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={formData.is_recurring}\r\n                                        onChange={(e) => setFormData(prev => ({ ...prev, is_recurring: e.target.checked }))}\r\n                                    />\r\n                                    <span>Es recurrente</span>\r\n                                </label>\r\n                            </div>\r\n\r\n                            <div className=\"modal-actions\">\r\n                                <button type=\"button\" className=\"btn btn-secondary\" onClick={() => setShowModal(false)}>\r\n                                    Cancelar\r\n                                </button>\r\n                                <button type=\"submit\" className=\"btn btn-primary\">\r\n                                    {editingTx ? 'Guardar Cambios' : 'Agregar Transacci√≥n'}\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\src\\test\\setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\PROYECTOS\\EMPRENDIMIENTO\\BC FABRIC SAS\\APP\\BC MONEY\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]